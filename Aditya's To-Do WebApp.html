<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Aditya's To-Do WebApp</title>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Plus+Jakarta+Sans%3Awght%40400%3B500%3B700%3B800" onload="this.rel='stylesheet'" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<style type="text/tailwindcss">
      body {
        font-family: "Plus Jakarta Sans", "Noto Sans", sans-serif;
        background: #0a0a0a;
        background-image: 
          radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
          radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.15) 0%, transparent 50%),
          radial-gradient(circle at 40% 40%, rgba(120, 219, 226, 0.2) 0%, transparent 50%),
          linear-gradient(135deg, rgba(30, 30, 30, 0.8) 0%, rgba(10, 10, 10, 0.9) 100%);
        min-height: 100vh;
        background-attachment: fixed;
      }
      .glassmorphism {
        background: rgba(15, 15, 25, 0.85);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 24px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }
      .task-item {
        transition: all 0.3s ease;
      }
      .task-item:not(:last-child) {
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      }
      .completed {
        text-decoration: line-through;
        color: rgba(255, 255, 255, 0.4);
      }
      .checkbox-custom:checked {
         background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
      }
      .priority-high { border-left: 4px solid #ff6b6b; background: rgba(255, 107, 107, 0.05); }
      .priority-medium { border-left: 4px solid #ffd93d; background: rgba(255, 217, 61, 0.05); }
      .priority-low { border-left: 4px solid #6bcf7f; background: rgba(107, 207, 127, 0.05); }
      .dragging { opacity: 0.5; }
      .subtask { margin-left: 2rem; padding-left: 1rem; border-left: 2px solid rgba(255,255,255,0.2); }
      .edit-mode { background: rgba(255,255,255,0.1); border-radius: 0.5rem; padding: 0.25rem; }
      .task-item {
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }
      .task-item:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.1);
      }
      
      /* Button Click Animations */
      .btn-click {
        animation: buttonClick 0.2s ease-in-out;
      }
      
      @keyframes buttonClick {
        0% { transform: scale(1); }
        50% { transform: scale(0.95); }
        100% { transform: scale(1); }
      }
      
      /* Page Transition Animations */
      .fade-out {
        animation: fadeOut 0.3s ease-in-out;
        opacity: 0;
      }
      
      .fade-in {
        animation: fadeIn 0.3s ease-in-out;
        opacity: 1;
      }
      
      @keyframes fadeOut {
        from { opacity: 1; transform: translateY(0); }
        to { opacity: 0; transform: translateY(-10px); }
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      /* Filter Button Transition */
      .filter-transition {
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }
      
      /* Delete Animation */
      .deleting {
        animation: deleteTask 0.5s ease-in-out forwards;
      }
      
      @keyframes deleteTask {
        0% { 
          opacity: 1; 
          transform: translateX(0) scale(1);
          max-height: 80px;
        }
        50% { 
          opacity: 0.5; 
          transform: translateX(20px) scale(0.8);
        }
        100% { 
          opacity: 0; 
          transform: translateX(100px) scale(0);
          max-height: 0;
          padding: 0;
          margin: 0;
        }
      }
      
      /* Pulse Animation for Active Elements */
      .pulse-glow {
        animation: pulseGlow 0.6s ease-in-out;
      }
      
      @keyframes pulseGlow {
        0%, 100% { 
          box-shadow: 0 0 5px rgba(147, 51, 234, 0.3);
        }
        50% { 
          box-shadow: 0 0 20px rgba(147, 51, 234, 0.6), 0 0 30px rgba(147, 51, 234, 0.4);
        }
      }
      
      /* Smooth transitions for all interactive elements */
      button, input, select {
        transition: all 0.3s ease;
      }
      
      /* New Task Animation */
      .task-new {
        animation: slideInNew 0.5s ease-out;
      }
      
      @keyframes slideInNew {
        from { 
          opacity: 0; 
          transform: translateX(-30px) scale(0.8);
        }
        to { 
          opacity: 1; 
          transform: translateX(0) scale(1);
        }
      }
      
      /* Checkbox Toggle Animation */
      .checkbox-toggle {
        animation: checkboxPulse 0.3s ease-in-out;
      }
      
      @keyframes checkboxPulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.2); }
        100% { transform: scale(1); }
      }
      
      /* Mark All Complete Animation */
      .mark-complete-wave {
        animation: completeWave 0.6s ease-in-out;
      }
      
      @keyframes completeWave {
        0% { 
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7);
        }
        50% { 
          transform: scale(1.05);
          box-shadow: 0 0 0 10px rgba(34, 197, 94, 0);
        }
        100% { 
          transform: scale(1);
          box-shadow: 0 0 0 20px rgba(34, 197, 94, 0);
        }
      }
      
      /* Staggered Complete Animation */
      .completing {
        animation: taskCompleting 0.4s ease-in-out;
      }
      
      @keyframes taskCompleting {
        0% { 
          background: rgba(255, 255, 255, 0.02);
          transform: translateX(0);
        }
        50% { 
          background: rgba(34, 197, 94, 0.2);
          transform: translateX(5px);
        }
        100% { 
          background: rgba(255, 255, 255, 0.02);
          transform: translateX(0);
        }
      }
      
      /* Form Validation Error Animation */
      .field-error {
        animation: fieldShake 0.5s ease-in-out;
        border-color: #ef4444 !important;
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2) !important;
      }
      
      @keyframes fieldShake {
        0%, 20%, 40%, 60%, 80%, 100% {
          transform: translateX(0);
        }
        10%, 30%, 50%, 70%, 90% {
          transform: translateX(-5px);
        }
        15%, 35%, 55%, 75%, 95% {
          transform: translateX(5px);
        }
      }
    </style>
</head>
<body class="min-h-screen p-4">
<div class="w-full max-w-6xl mx-auto space-y-6">
  
  <!-- Header Panel -->
  <div class="glassmorphism p-6">
    <h1 class="text-4xl font-bold text-center text-white">Aditya's To-Do WebApp</h1>
  </div>

  <!-- Form Panel -->
  <div class="glassmorphism p-6">
    <div class="space-y-4">
      <!-- Task Input Row -->
      <div>
        <input id="taskInput" class="w-full p-4 text-white placeholder-gray-400 bg-white/5 border-2 border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400/50 focus:border-purple-400/50 backdrop-blur-sm" placeholder="Add a new task..." type="text"/>
      </div>
      
      <!-- Date and Priority Row -->
      <div class="flex gap-4">
        <input id="dueDateInput" type="date" class="flex-1 p-3 text-white bg-white/5 border-2 border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400/50 backdrop-blur-sm" style="color-scheme: dark;"/>
        <select id="prioritySelect" class="flex-1 p-3 text-white bg-white/5 border-2 border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400/50 backdrop-blur-sm">
          <option value="" disabled selected class="text-gray-400 bg-gray-900">Please select priority</option>
          <option value="high" class="text-white bg-gray-900">High Priority</option>
          <option value="medium" class="text-white bg-gray-900">Medium Priority</option>
          <option value="low" class="text-white bg-gray-900">Low Priority</option>
        </select>
      </div>
      
      <!-- Add Button Row -->
      <div>
        <button id="addTaskBtn" class="px-8 py-3 font-bold text-white transition-all bg-gradient-to-r from-purple-500/30 to-blue-500/30 hover:from-purple-500/40 hover:to-blue-500/40 rounded-lg backdrop-blur-sm border border-white/10">
          Add Task
        </button>
      </div>
    </div>
  </div>

  <!-- Table Panel -->
  <div class="glassmorphism p-6">
    <!-- Table Header Controls -->
    <div class="flex justify-between items-center mb-6">
      <!-- Filter Buttons (Left) -->
      <div class="flex gap-2">
        <button id="filterAll" class="px-4 py-2 font-bold text-white transition-all bg-gradient-to-r from-purple-500/30 to-blue-500/30 hover:from-purple-500/40 hover:to-blue-500/40 rounded-lg filter-btn active backdrop-blur-sm border border-white/10">
          All (<span id="totalTasks">0</span>)
        </button>
        <button id="filterActive" class="px-4 py-2 font-bold text-white transition-all bg-white/10 hover:from-purple-500/20 hover:to-blue-500/20 hover:bg-gradient-to-r rounded-lg filter-btn backdrop-blur-sm border border-white/10">
          Active (<span id="activeTasks">0</span>)
        </button>
        <button id="filterCompleted" class="px-4 py-2 font-bold text-white transition-all bg-white/10 hover:from-purple-500/20 hover:to-blue-500/20 hover:bg-gradient-to-r rounded-lg filter-btn backdrop-blur-sm border border-white/10">
          Completed (<span id="completedTasks">0</span>)
        </button>
      </div>

      <!-- Search and Delete Controls (Right) -->
      <div class="flex gap-2">
        <!-- Search Toggle -->
        <button id="searchToggleBtn" class="p-2 text-white transition-all bg-white/10 hover:bg-white/20 rounded-lg backdrop-blur-sm border border-white/10" title="Search Tasks">
          <span class="material-symbols-outlined">search</span>
        </button>
        
        <!-- Mark All Complete -->
        <button id="markAllCompleteBtn" class="p-2 text-white transition-all bg-gradient-to-r from-green-500/30 to-emerald-500/30 hover:from-green-500/40 hover:to-emerald-500/40 rounded-lg backdrop-blur-sm border border-white/10" title="Mark All Complete">
          <span class="material-symbols-outlined">done_all</span>
        </button>
        
        <!-- Delete Dropdown -->
        <div class="relative">
          <button id="deleteDropdownBtn" class="p-2 text-white transition-all bg-gradient-to-r from-red-500/30 to-pink-500/30 hover:from-red-500/40 hover:to-pink-500/40 rounded-lg backdrop-blur-sm border border-white/10" title="Delete Options">
            <span class="material-symbols-outlined">delete</span>
          </button>
          <div id="deleteDropdown" class="absolute right-0 top-12 hidden bg-black/80 backdrop-blur-sm border border-white/10 rounded-lg shadow-lg z-10">
            <button id="deleteAll" class="block w-full px-4 py-2 text-left text-white hover:bg-white/10 rounded-t-lg">Delete All</button>
            <button id="deleteCompleted" class="block w-full px-4 py-2 text-left text-white hover:bg-white/10 rounded-b-lg">Delete Completed</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Search Input (Hidden by default) -->
    <div id="searchContainer" class="mb-4 hidden">
      <input id="searchInput" class="w-full p-3 text-white placeholder-gray-400 bg-white/5 border-2 border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400/50 focus:border-purple-400/50 backdrop-blur-sm" placeholder="Search tasks..." type="text"/>
    </div>

    <!-- Tasks Container -->
    <div id="tasksContainer" class="space-y-2 text-white min-h-[300px]">
      <div class="text-center text-white/50 py-12" id="emptyState">
        <span class="material-symbols-outlined text-6xl mb-4 block">task_alt</span>
        <p>No tasks yet. Add your first task above!</p>
      </div>
    </div>
  </div>
</div>

<script>
class TodoApp {
  constructor() {
    this.tasks = JSON.parse(localStorage.getItem('todoTasks')) || [];
    this.currentFilter = 'all';
    this.searchQuery = '';
    this.taskIdCounter = parseInt(localStorage.getItem('taskIdCounter')) || 1;
    
    this.initializeElements();
    this.bindEvents();
    this.render();
    this.initializeDragAndDrop();
  }

  initializeElements() {
    this.taskInput = document.getElementById('taskInput');
    this.addTaskBtn = document.getElementById('addTaskBtn');
    this.tasksContainer = document.getElementById('tasksContainer');
    this.searchInput = document.getElementById('searchInput');
    this.searchContainer = document.getElementById('searchContainer');
    this.searchToggleBtn = document.getElementById('searchToggleBtn');
    this.markAllCompleteBtn = document.getElementById('markAllCompleteBtn');
    this.prioritySelect = document.getElementById('prioritySelect');
    this.dueDateInput = document.getElementById('dueDateInput');
    this.emptyState = document.getElementById('emptyState');
    
    // Filter buttons
    this.filterBtns = document.querySelectorAll('.filter-btn');
    
    // Delete dropdown
    this.deleteDropdownBtn = document.getElementById('deleteDropdownBtn');
    this.deleteDropdown = document.getElementById('deleteDropdown');
    this.deleteAllBtn = document.getElementById('deleteAll');
    this.deleteCompletedBtn = document.getElementById('deleteCompleted');
    
    // Stats
    this.totalTasksEl = document.getElementById('totalTasks');
    this.activeTasksEl = document.getElementById('activeTasks');
    this.completedTasksEl = document.getElementById('completedTasks');
  }

  bindEvents() {
    this.addTaskBtn.addEventListener('click', (e) => {
      this.addClickAnimation(e.target);
      this.addTask();
    });

    this.taskInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        this.addClickAnimation(this.addTaskBtn);
        this.addTask();
      }
    });

    this.dueDateInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        this.addClickAnimation(this.addTaskBtn);
        this.addTask();
      }
    });

    this.prioritySelect.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        this.addClickAnimation(this.addTaskBtn);
        this.addTask();
      }
    });
    
    this.searchInput.addEventListener('input', (e) => {
      this.searchQuery = e.target.value.toLowerCase();
      this.renderWithTransition();
    });

    // Search toggle functionality
    this.searchToggleBtn.addEventListener('click', (e) => {
      this.addClickAnimation(e.target);
      this.toggleSearch();
    });

    // Mark all complete functionality
    this.markAllCompleteBtn.addEventListener('click', (e) => {
      this.addClickAnimation(e.target);
      this.markAllComplete();
    });

    this.filterBtns.forEach(btn => {
      btn.addEventListener('click', (e) => {
        this.addClickAnimation(e.target);
        this.setFilterWithTransition(btn.id.replace('filter', '').toLowerCase());
      });
    });

    // Delete dropdown events
    this.deleteDropdownBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      this.addClickAnimation(e.target);
      this.toggleDeleteDropdown();
    });
    
    this.deleteAllBtn.addEventListener('click', (e) => {
      this.addClickAnimation(e.target);
      this.deleteAllTasks();
      this.hideDeleteDropdown();
    });
    
    this.deleteCompletedBtn.addEventListener('click', (e) => {
      this.addClickAnimation(e.target);
      this.clearCompleted();
      this.hideDeleteDropdown();
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', () => this.hideDeleteDropdown());
  }

  addTask() {
    const taskText = this.taskInput.value.trim();
    const dueDate = this.dueDateInput.value;
    const priority = this.prioritySelect.value;

    // Validation - check if all fields are filled
    const fieldsToValidate = [
      { element: this.taskInput, value: taskText, name: 'task' },
      { element: this.dueDateInput, value: dueDate, name: 'date' },
      { element: this.prioritySelect, value: priority, name: 'priority' }
    ];

    const emptyFields = fieldsToValidate.filter(field => !field.value);

    if (emptyFields.length > 0) {
      // Add error animation to empty fields
      emptyFields.forEach(field => {
        field.element.classList.add('field-error');
        setTimeout(() => {
          field.element.classList.remove('field-error');
        }, 500);
      });
      return;
    }

    const newTask = {
      id: Date.now(),
      text: taskText,
      completed: false,
      dueDate: dueDate,
      priority: priority
    };

    this.tasks.push(newTask);
    this.taskInput.value = '';
    this.dueDateInput.value = '';
    this.prioritySelect.value = '';
    this.saveToStorage();
    this.render();

    // Add new task animation
    setTimeout(() => {
      const newTaskElement = document.querySelector(`[data-task-id="${newTask.id}"]`);
      if (newTaskElement) {
        newTaskElement.classList.add('new-task-animation');
        setTimeout(() => {
          newTaskElement.classList.remove('new-task-animation');
        }, 500);
      }
    }, 50);
  }

  addClickAnimation(button) {
    button.classList.add('btn-click');
    setTimeout(() => {
      button.classList.remove('btn-click');
    }, 200);
  }

  toggleSearch() {
    this.addClickAnimation(this.searchToggleBtn);
    this.searchContainer.classList.toggle('hidden');
    if (!this.searchContainer.classList.contains('hidden')) {
      this.searchInput.focus();
      this.searchContainer.classList.add('fade-in');
      setTimeout(() => {
        this.searchContainer.classList.remove('fade-in');
      }, 300);
    } else {
      this.searchInput.value = '';
      this.searchQuery = '';
      this.renderWithTransition();
    }
  }

  setFilterWithTransition(filter) {
    // Add fade-out to current content
    this.tasksContainer.classList.add('fade-out');
    
    setTimeout(() => {
      this.setFilter(filter);
      this.tasksContainer.classList.remove('fade-out');
      this.tasksContainer.classList.add('fade-in');
      
      setTimeout(() => {
        this.tasksContainer.classList.remove('fade-in');
      }, 300);
    }, 150);
  }

  renderWithTransition() {
    this.tasksContainer.classList.add('fade-out');
    
    setTimeout(() => {
      this.render();
      this.tasksContainer.classList.remove('fade-out');
      this.tasksContainer.classList.add('fade-in');
      
      setTimeout(() => {
        this.tasksContainer.classList.remove('fade-in');
      }, 300);
    }, 150);
  }

  toggleDeleteDropdown() {
    this.deleteDropdown.classList.toggle('hidden');
  }

  hideDeleteDropdown() {
    this.deleteDropdown.classList.add('hidden');
  }

  deleteAllTasks() {
    if (confirm('Are you sure you want to delete all tasks? This action cannot be undone.')) {
      this.tasks = [];
      this.saveToStorage();
      this.render();
    }
  }

  findTaskById(id, taskList = this.tasks) {
    for (let task of taskList) {
      if (task.id === id) return task;
      if (task.subtasks.length > 0) {
        const found = this.findTaskById(id, task.subtasks);
        if (found) return found;
      }
    }
    return null;
  }

  toggleTask(id) {
    const task = this.findTaskById(id);
    if (task) {
      task.completed = !task.completed;
      this.saveToStorage();
      this.render();
    }
  }

  toggleTaskWithAnimation(id, checkbox) {
    checkbox.classList.add('checkbox-toggle');
    setTimeout(() => {
      checkbox.classList.remove('checkbox-toggle');
    }, 300);
    
    this.toggleTask(id);
  }

  markAllComplete() {
    // Add wave animation to button
    this.markAllCompleteBtn.classList.add('mark-complete-wave');
    setTimeout(() => {
      this.markAllCompleteBtn.classList.remove('mark-complete-wave');
    }, 600);

    // Get all incomplete tasks
    const incompleteTasks = this.tasks.filter(task => !task.completed);
    
    if (incompleteTasks.length === 0) {
      return; // No tasks to complete
    }

    // Add staggered animation to task elements
    const taskElements = document.querySelectorAll('.task-item');
    let animationDelay = 0;
    
    taskElements.forEach((taskElement, index) => {
      const taskId = parseInt(taskElement.dataset.taskId);
      const task = this.tasks.find(t => t.id === taskId);
      
      if (task && !task.completed) {
        setTimeout(() => {
          taskElement.classList.add('completing');
          
          // Remove animation class after completion
          setTimeout(() => {
            taskElement.classList.remove('completing');
          }, 400);
          
          // Mark task as complete
          task.completed = true;
          
          // Update checkbox with animation
          const checkbox = taskElement.querySelector('input[type="checkbox"]');
          if (checkbox) {
            checkbox.checked = true;
            checkbox.classList.add('checkbox-toggle');
            setTimeout(() => {
              checkbox.classList.remove('checkbox-toggle');
            }, 300);
          }
          
        }, animationDelay);
        
        animationDelay += 100; // Stagger by 100ms
      }
    });
    
    // Save and re-render after all animations complete
    setTimeout(() => {
      this.saveToStorage();
      this.render();
    }, animationDelay + 500);
  }

  deleteTask(id) {
    const taskElement = document.querySelector(`[data-task-id="${id}"]`);
    if (taskElement) {
      taskElement.classList.add('deleting');
      setTimeout(() => {
        this.tasks = this.removeTaskById(id, this.tasks);
        this.saveToStorage();
        this.render();
      }, 500);
    } else {
      this.tasks = this.removeTaskById(id, this.tasks);
      this.saveToStorage();
      this.render();
    }
  }

  removeTaskById(id, taskList) {
    return taskList.filter(task => {
      if (task.id === id) return false;
      if (task.subtasks.length > 0) {
        task.subtasks = this.removeTaskById(id, task.subtasks);
      }
      return true;
    });
  }

  editTask(id, newText) {
    const task = this.findTaskById(id);
    if (task) {
      task.text = newText;
      this.saveToStorage();
      this.render();
    }
  }

  setFilter(filter) {
    this.currentFilter = filter;
    this.filterBtns.forEach(btn => {
      // Add filter transition class
      btn.classList.add('filter-transition');
      // Remove all active styles
      btn.classList.remove('active', 'bg-white/30', 'bg-gradient-to-r', 'from-purple-500/30', 'to-blue-500/30', 'from-purple-500/40', 'to-blue-500/40');
      // Add inactive styles
      btn.classList.add('bg-white/10');
      btn.classList.remove('bg-white/20');
    });
    
    const activeBtn = document.getElementById(`filter${filter.charAt(0).toUpperCase() + filter.slice(1)}`);
    if (activeBtn) {
      // Remove inactive styles
      activeBtn.classList.remove('bg-white/10', 'bg-white/20');
      // Add active purple gradient styles and glow
      activeBtn.classList.add('active', 'bg-gradient-to-r', 'from-purple-500/30', 'to-blue-500/30', 'pulse-glow');
      
      // Remove glow after animation
      setTimeout(() => {
        activeBtn.classList.remove('pulse-glow');
      }, 600);
    }
    
    this.render();
  }

  clearCompleted() {
    const completedTasks = document.querySelectorAll('.task-item input[type="checkbox"]:checked');
    let animationPromises = [];
    
    completedTasks.forEach(checkbox => {
      const taskElement = checkbox.closest('.task-item');
      if (taskElement) {
        taskElement.classList.add('deleting');
        animationPromises.push(new Promise(resolve => {
          setTimeout(resolve, 500);
        }));
      }
    });
    
    if (animationPromises.length > 0) {
      Promise.all(animationPromises).then(() => {
        this.tasks = this.tasks.filter(task => !task.completed);
        this.saveToStorage();
        this.render();
      });
    } else {
      this.tasks = this.tasks.filter(task => !task.completed);
      this.saveToStorage();
      this.render();
    }
  }

  getFilteredTasks() {
    let filtered = [...this.tasks];
    
    // Apply search filter
    if (this.searchQuery) {
      filtered = filtered.filter(task => 
        task.text.toLowerCase().includes(this.searchQuery)
      );
    }
    
    // Apply status filter
    if (this.currentFilter === 'active') {
      filtered = filtered.filter(task => !task.completed);
    } else if (this.currentFilter === 'completed') {
      filtered = filtered.filter(task => task.completed);
    }
    
    return filtered;
  }

  createTaskElement(task) {
    const taskEl = document.createElement('div');
    taskEl.className = `task-item p-4 rounded-lg priority-${task.priority} ${task.isNew ? 'task-new' : ''}`;
    taskEl.draggable = true;
    taskEl.dataset.taskId = task.id;
    
    const dueDateDisplay = task.dueDate ? 
      `<span class="text-xs text-white/60 ml-2">Due: ${new Date(task.dueDate).toLocaleDateString()}</span>` : '';
    
    taskEl.innerHTML = `
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4 flex-grow">
          <input type="checkbox" ${task.completed ? 'checked' : ''} 
                 class="w-6 h-6 rounded-md appearance-none cursor-pointer checkbox-custom bg-white/30 checked:bg-orange-400 focus:outline-none focus:ring-2 focus:ring-orange-400/50"
                 onchange="todoApp.toggleTaskWithAnimation(${task.id}, this)"/>
          <div class="flex-grow">
            <span class="text-lg task-text ${task.completed ? 'completed' : ''}" onclick="todoApp.startEdit(${task.id}, this)">${task.text}</span>
            ${dueDateDisplay}
            <div class="text-xs text-white/50 mt-1">
              Priority: ${task.priority.toUpperCase()}
            </div>
          </div>
        </div>
        <div class="flex gap-2">
          <button onclick="todoApp.deleteTask(${task.id})" class="text-white/70 hover:text-white" title="Delete">
            <span class="material-symbols-outlined">delete</span>
          </button>
        </div>
      </div>
    `;
    
    return taskEl;
  }

  startEdit(id, element) {
    const task = this.findTaskById(id);
    if (!task) return;
    
    const input = document.createElement('input');
    input.type = 'text';
    input.value = task.text;
    input.className = 'bg-transparent border border-white/50 rounded px-2 py-1 text-white edit-mode';
    
    element.replaceWith(input);
    input.focus();
    input.select();
    
    const finishEdit = () => {
      const newText = input.value.trim();
      if (newText && newText !== task.text) {
        this.editTask(id, newText);
      } else {
        this.render();
      }
    };
    
    input.addEventListener('blur', finishEdit);
    input.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') finishEdit();
    });
  }

  updateStats() {
    const total = this.tasks.length;
    const completed = this.tasks.filter(task => task.completed).length;
    const active = total - completed;
    
    this.totalTasksEl.textContent = total;
    this.activeTasksEl.textContent = active;
    this.completedTasksEl.textContent = completed;
  }

  render() {
    const filteredTasks = this.getFilteredTasks();
    this.tasksContainer.innerHTML = '';
    
    if (filteredTasks.length === 0) {
      this.emptyState.style.display = 'block';
      this.tasksContainer.appendChild(this.emptyState);
    } else {
      this.emptyState.style.display = 'none';
      
      filteredTasks.forEach(task => {
        const taskElement = this.createTaskElement(task);
        this.tasksContainer.appendChild(taskElement);
      });
    }
    
    this.updateStats();
  }

  initializeDragAndDrop() {
    Sortable.create(this.tasksContainer, {
      animation: 150,
      ghostClass: 'dragging',
      filter: '.subtask',
      onEnd: (evt) => {
        const taskId = parseInt(evt.item.dataset.taskId);
        const newIndex = evt.newIndex;
        
        // Reorder tasks array
        const task = this.tasks.find(t => t.id === taskId);
        const oldIndex = this.tasks.indexOf(task);
        
        this.tasks.splice(oldIndex, 1);
        this.tasks.splice(newIndex, 0, task);
        
        this.saveToStorage();
      }
    });
  }

  saveToStorage() {
    localStorage.setItem('todoTasks', JSON.stringify(this.tasks));
    localStorage.setItem('taskIdCounter', this.taskIdCounter.toString());
  }
}

// Initialize the app
const todoApp = new TodoApp();
</script>

</body></html>